<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>갤러리 게시판 4x3</title>
  <style>
    :root{
      --max: 1100px;
      --gap: 18px;
      --border: #e6e6e6;
      --text: #222;
      --muted: #777;
      --accent: #111;
      --bg: #fff;
      --radius: 10px;
    }

    *{ box-sizing: border-box; }
    body{
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      color: var(--text);
      background: var(--bg);
    }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 28px 18px 60px;
    }

    /* ===== 상단 대표 이미지 영역 ===== */
    .hero{
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      background: #fafafa;
    }
    .hero img{
      width: 100%;
      height: auto;
      display: block;
    }
    .hero-caption{
      text-align: center;
      font-size: 14px;
      color: var(--muted);
      padding: 12px 10px 16px;
    }

    /* ===== 갤러리 그리드 ===== */
    .gallery{
      margin-top: 26px;
    }

    .grid{
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* 4열 */
      gap: var(--gap);
    }

    .card{
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      background: #fff;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
    }

    .thumb{
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1; /* 정사각 썸네일 */
      background: #f3f3f3;
      overflow: hidden;
    }
    .thumb img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .meta{
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .title{
      font-size: 14px;
      font-weight: 600;
      line-height: 1.25;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .date{
      font-size: 12px;
      color: var(--muted);
    }

    /* ===== 페이지네이션 ===== */
    .pager{
      margin-top: 22px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      user-select: none;
    }

    .pager button{
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      padding: 8px 10px;
      border-radius: 8px;
      cursor: pointer;
      min-width: 38px;
      transition: background 120ms ease, border-color 120ms ease;
    }
    .pager button:hover{
      background: #f6f6f6;
    }
    .pager button:disabled{
      opacity: .45;
      cursor: not-allowed;
    }

    .pager .num{
      min-width: 38px;
      padding: 8px 10px;
    }
    .pager .active{
      border-color: var(--accent);
      background: var(--accent);
      color: #fff;
      font-weight: 700;
    }

    /* ===== 반응형 ===== */
    @media (max-width: 980px){
      .grid{ grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 720px){
      .grid{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 420px){
      .grid{ grid-template-columns: 1fr; }
      .pager{ flex-wrap: wrap; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- 상단 대표 이미지(썸네일 클릭 시 여기로 표시됨) -->
    <figure class="hero" id="hero">
      <img id="heroImg"
           src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=1600&auto=format&fit=crop&q=60"
           alt="상단 대표 이미지" />
      <figcaption class="hero-caption" id="heroCaption">▲ 고층 건설현장 타워크레인 관제</figcaption>
    </figure>

    <!-- 갤러리 -->
    <section class="gallery" aria-label="갤러리 게시판">
      <div id="grid" class="grid"></div>
      <nav class="pager" aria-label="페이지네이션" id="pager"></nav>
    </section>

  </div>

  <script>
    /************************************************************
     * ✅ 갤러리 데이터
     ************************************************************/
    const items = Array.from({ length: 53 }, (_, i) => {
      const n = i + 1;
      return {
        id: n,
        title: `현장 스냅샷 ${String(n).padStart(2, "0")}`,
        date: "2026.01.16",
        img: `https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=1200&auto=format&fit=crop&q=60&sig=${n}`
      };
    });

    /************************************************************
     * ✅ 설정값
     ************************************************************/
    const PER_PAGE = 12;        // 4x3 = 12개
    const PAGE_WINDOW = 5;      // 페이지 번호 1~5 처럼 몇 개 보여줄지
    let currentPage = 1;

    // ✅ 마지막으로 클릭한 이미지 유지용 (핵심)
    let selectedId = null;

    const $grid = document.getElementById("grid");
    const $pager = document.getElementById("pager");

    const $heroImg = document.getElementById("heroImg");
    const $heroCaption = document.getElementById("heroCaption");

    function getTotalPages() {
      return Math.ceil(items.length / PER_PAGE);
    }

    function sliceByPage(page) {
      const start = (page - 1) * PER_PAGE;
      const end = start + PER_PAGE;
      return items.slice(start, end);
    }

    function setHero(item) {
      if (!item) return;
      $heroImg.src = item.img;
      $heroImg.alt = item.title;
      $heroCaption.textContent = `▲ ${item.title}`;
    }

    function renderGrid(page) {
      const pageItems = sliceByPage(page);

      $grid.innerHTML = pageItems.map((it) => {
        return `
          <article class="card"
                   data-id="${it.id}"
                   tabindex="0"
                   role="button"
                   aria-label="${escapeHtml(it.title)} 상단에 표시">
            <div class="thumb">
              <img src="${it.img}" alt="${escapeHtml(it.title)}" loading="lazy">
            </div>
            <div class="meta">
              <div class="title">${escapeHtml(it.title)}</div>
              <div class="date">${escapeHtml(it.date)}</div>
            </div>
          </article>
        `;
      }).join("");

      // ✅ 카드 클릭/엔터 → 상단(hero)로 표시 + selectedId 저장
      $grid.querySelectorAll(".card").forEach(card => {
        const id = Number(card.dataset.id);
        const item = items.find(x => x.id === id);

        card.addEventListener("click", () => {
          selectedId = id;     // ⭐ 마지막 선택 저장
          setHero(item);
        });

        card.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            selectedId = id;   // ⭐ 마지막 선택 저장
            setHero(item);
          }
        });
      });

      // ✅ 페이지 이동해도 상단(hero)은 "마지막 클릭 이미지" 그대로 유지
      // - 단, 사용자가 아직 한 번도 클릭한 적이 없으면(최초)만 1번 세팅
      if (selectedId === null && pageItems.length) {
        selectedId = pageItems[0].id; // 최초 기준값만 잡아두고
        setHero(pageItems[0]);        // 최초 1회만 상단 세팅
      } else if (selectedId !== null) {
        const selectedItem = items.find(x => x.id === selectedId);
        if (selectedItem) setHero(selectedItem); // ✅ 항상 마지막 클릭 유지
      }
    }

    function renderPager(page) {
      const total = getTotalPages();

      const start = Math.floor((page - 1) / PAGE_WINDOW) * PAGE_WINDOW + 1;
      const end = Math.min(start + PAGE_WINDOW - 1, total);

      const nums = [];
      for (let p = start; p <= end; p++) nums.push(p);

      $pager.innerHTML = `
        <button type="button" data-action="first" ${page === 1 ? "disabled" : ""} aria-label="첫 페이지">«</button>
        <button type="button" data-action="prev"  ${page === 1 ? "disabled" : ""} aria-label="이전 페이지">‹</button>

        ${nums.map(p => `
          <button type="button" class="num ${p === page ? "active" : ""}" data-page="${p}" aria-label="${p}페이지">${p}</button>
        `).join("")}

        <button type="button" data-action="next" ${page === total ? "disabled" : ""} aria-label="다음 페이지">›</button>
        <button type="button" data-action="last" ${page === total ? "disabled" : ""} aria-label="마지막 페이지">»</button>
      `;

      $pager.onclick = (e) => {
        const btn = e.target.closest("button");
        if (!btn) return;

        const totalPages = getTotalPages();

        if (btn.dataset.page) {
          goToPage(Number(btn.dataset.page));
          return;
        }

        const action = btn.dataset.action;
        if (action === "first") goToPage(1);
        if (action === "prev")  goToPage(Math.max(1, currentPage - 1));
        if (action === "next")  goToPage(Math.min(totalPages, currentPage + 1));
        if (action === "last")  goToPage(totalPages);
      };
    }

    function goToPage(page) {
      const total = getTotalPages();
      const nextPage = Math.min(Math.max(1, page), total);

      currentPage = nextPage;
      renderGrid(currentPage);
      renderPager(currentPage);
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // 최초 렌더
    goToPage(1);
  </script>
</body>
</html>
